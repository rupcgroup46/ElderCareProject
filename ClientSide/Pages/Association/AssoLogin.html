<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link href="../../CSS/AssociationCSS/AssoLogin.css" rel="stylesheet" />
    
    <script>
      $(document).ready(function() {

        //reset the assocation id
        sessionStorage.setItem("association_id", 0);

        //association login
        $("#assoLogin").submit(function(){
          const email = $("#emailInput").val();
          const password = $("#passwordInput").val();
          fetch(`https://proj.ruppin.ac.il/cgroup46/prod/api/Associations/email/${email}/password/${password}`, {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json'
            },
          })
            .then(response => {
              if (!response.ok) {
                throw new Error(response.statusText);
              }
              return response.json();
            })
            .then(data => {
              console.log("Logged in: ",data);
              sessionStorage.setItem("association_id", data.id);
              window.location.href = "NewApps-Association.html";
              alert("ברוכים השבים!");
            })
            .catch(error => {
              console.error("Error: wrong inputs ",error)
              alert("שם משתמש או סיסמה שגויים, אנא נסה שנית!");
              clearFields();
            });

          return false;
        })
      })

      function clearFields(){
        $("#emailInput").val("");
        $("#passwordInput").val("");
      }
    </script>
</head>
<body>
    <div class="container contact-form text-center">
        <form id="assoLogin" method="post">
              <div class="">
                  <h5>:ברוכים השבים, אנא התחברו</h5>
                  <div class="form-group">
                      <input id="emailInput" type="text" name="txtEmail" class="form-control" placeholder="* אימייל" value="" />
                  </div>
                  <div class="form-group">
                      <input id="passwordInput" type="text" name="txtPassword" class="form-control" placeholder="* סיסמה" value="" />
                  </div>
                  <div class="form-group">
                      <input type="submit" name="btnSubmit" class="btnContact" value="התחבר" />
                  </div>
                  <div class="form-group">
                      <a href="" onclick="{alert('Under constructions')}">משתמש חדש? הירשם עכשיו</a> 
                  </div>
              </div>
        </form>
    </div>
</body>
</html>